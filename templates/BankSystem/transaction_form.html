{% extends "BankSystem/_base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<h3 class="mb-3">{{ title }}</h3>

<div class="alert alert-info small">
  <div><strong>Deposit/Withdrawal:</strong> use the <em>Account</em> field.</div>
  <div><strong>Transfer:</strong> use <em>From account</em> and <em>To account</em> (they must be different).</div>
</div>

<form method="post" novalidate>
  {% csrf_token %}
  <div class="row g-3">
    <div class="col-md-4">{{ form.txn_type.label_tag }} {{ form.txn_type }}</div>
    <div class="col-md-4">{{ form.account.label_tag }} {{ form.account }}</div>
    <div class="col-md-4">{{ form.amount.label_tag }} {{ form.amount }}</div>
    <div class="col-md-6">{{ form.from_account.label_tag }} {{ form.from_account }}</div>
    <div class="col-md-6">{{ form.to_account.label_tag }} {{ form.to_account }}</div>
    <div class="col-12">{{ form.note.label_tag }} {{ form.note }}</div>
  </div>

  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-primary">Save</button>
    <a class="btn btn-outline-secondary" href="{% url 'banksystem:transaction_list' %}">Cancel</a>
  </div>
</form>

<script>
  // Small client-side helper: hide irrelevant fields by selection
  const txnTypeEl = document.getElementById("id_txn_type");
  const accountRow = document.getElementById("id_account")?.closest(".col-md-4");
  const fromRow = document.getElementById("id_from_account")?.closest(".col-md-6");
  const toRow = document.getElementById("id_to_account")?.closest(".col-md-6");

  function sync() {
    const t = txnTypeEl.value;
    if (accountRow && fromRow && toRow) {
      if (t === "TRANSFER") {
        accountRow.style.display = "none";
        fromRow.style.display = "";
        toRow.style.display = "";
      } else {
        accountRow.style.display = "";
        fromRow.style.display = "none";
        toRow.style.display = "none";
      }
    }
  }
  txnTypeEl?.addEventListener("change", sync);
  sync();
</script>
{% endblock %}
